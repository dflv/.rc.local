#!/bin/bash

PREFIX="/Users/niannian/Lab"

GIT_REPO=(
        "amazon-freertos"
        "darwin-xnu"
        "f9-kernel"
        "lwip"
        "mbed-coap"
        "mbed-os"
        "mbedtls"
        "openssl"
        "uvisor"
        "wolfmqtt-0.14.0"
        "zephyr"
        )

for git_repo in ${GIT_REPO[@]}; do
    pushd "$PREFIX/$git_repo" >& /dev/null

    if [ -e .git ]; then

        UPSTREAM=${1:-'@{u}'}
        LOCAL=$(git rev-parse @)
        REMOTE=$(git rev-parse "$UPSTREAM")
        BASE=$(git merge-base @ "$UPSTREAM")

        if [ $LOCAL = $REMOTE ]; then
            echo "[ UP2DATE ] $PREFIX/$git_repo"
        elif [ $LOCAL = $BASE ]; then
            git pull >& /dev/null
            cscope -Rkb >& /dev/null
            ctags -R >& /dev/null
            echo "[ UPDATED ] $PREFIX/$git_repo"
        elif [ $REMOTE = $BASE ]; then
            echo "[NEED2PUSH] $PREFIX/$git_repo"
        else
            echo "[CONFLICTS] $PREFIX/$git_repo"
        fi
    fi

    popd >& /dev/null
done
