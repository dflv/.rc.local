#!/bin/bash

PREFIX="/Users/niannian/Lab"

GIT_REPO=(
        "amazon-freertos"
        "darwin-xnu"
        "f9-kernel"
        "linux"
        "lwip"
        "mbed-coap"
        "mbed-os"
        "mbedtls"
        "openssl"
        "uvisor"
        "wolfmqtt-0.14.0"
        "zephyr"
        )

for git_repo in ${GIT_REPO[@]}; do
    pushd "$PREFIX/$git_repo" >& /dev/null

    if [ -e .git ]; then
        echo "[ CHECKING ] $PREFIX/$git_repo"
        eval "git pull --no-stat | grep \"Already up-to-date\.\""
        ret=$?
        if [ "$ret" == "1" ]; then
            echo "[ INDEXING ] $PREFIX/$git_repo"
            cscope -Rkb >& /dev/null
            ctags -R >& /dev/null
            echo "[  UPDATE  ] $PREFIX/$git_repo"
        else
            if [ "$1" == "-f" ]; then
                echo "[ INDEXING ] $PREFIX/$git_repo"
                cscope -Rkb >& /dev/null
                ctags -R >& /dev/null
            fi
            echo "[ UPTODATE ] $PREFIX/$git_repo"
        fi
    fi

    popd >& /dev/null
done
